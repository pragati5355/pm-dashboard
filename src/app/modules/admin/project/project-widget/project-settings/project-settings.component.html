<div
    matDialogTitle
    class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 bg-primary text-on-primary -mt-6 -mx-6"
>
    <div class="text-lg font-medium">Project settings</div>
    <button mat-icon-button (click)="cancel()" [tabIndex]="-1">
        <mat-icon
            class="text-current"
            [svgIcon]="'heroicons_outline:x'"
        ></mat-icon>
    </button>
</div>

<!-- <h2 mat-dialog-title>Project settings</h2> -->
<mat-dialog-content class="mat-typography">
    <div class="relative h-[620px]">
        <div class="fixed min-h-[620px] w-[200px] pt-2">
            <div
                class="pl-3 font-semibold py-2 mb-2 cursor-pointer"
                [ngClass]="{
                    'bg-gray-200': showStep === 0,
                    'font-semibold': showStep === 0
                }"
                (click)="changeStep(1)"
            >
                Cost setting
            </div>
        </div>

        <div class="ml-[220px] min-h-[620px] p-2" *ngIf="showStep === 0">
            <div class="">
                <div class="text-xl font-semibold mt-2 mb-4">Cost setting</div>

                <form [formGroup]="fixedCostForm">
                    <div class="flex flex-col w-full">
                        <div class="w-full flex flex-col flex-wrap">
                            <mat-label class="w-[400px]"
                                >Select cost type
                                <span class="text-gray-400"
                                    >(This setting can never be changed
                                    again)</span
                                ></mat-label
                            >
                            <mat-form-field class="w-[200px]">
                                <mat-select
                                    formControlName="costType"
                                    name="food"
                                    (selectionChange)="costTypeChange($event)"
                                >
                                    <mat-option
                                        *ngFor="let type of costTypes"
                                        [value]="type"
                                    >
                                        {{ type?.label }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div
                            class="w-[200px]"
                            *ngIf="
                                fixedCostForm?.get('costType')?.value?.value ===
                                'FIXED_COST'
                            "
                        >
                            <mat-form-field class="w-full">
                                <mat-label>Enter cost</mat-label>
                                <input
                                    type="number"
                                    matInput
                                    formControlName="costInput"
                                    placeholder="Enter cost"
                                    min="0"
                                />
                                <mat-error
                                    *ngIf="
                                        fixedCostForm
                                            ?.get('costInput')
                                            .hasError('required')
                                    "
                                >
                                    Cost is <strong>required</strong>
                                </mat-error>
                                <mat-error
                                    *ngIf="
                                        fixedCostForm
                                            ?.get('costInput')
                                            ?.hasError('pattern')
                                    "
                                >
                                    <div>
                                        Please enter valid <strong>cost</strong>
                                    </div>
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>
                </form>

                <form [formGroup]="timeAndMaterialForm">
                    <div
                        class="w-[200px]"
                        *ngIf="
                            fixedCostForm?.get('costType')?.value?.value ===
                            'TANDM'
                        "
                    >
                        <mat-form-field class="w-full">
                            <mat-label>Nature of cost</mat-label>
                            <mat-select
                                formControlName="type"
                                name="food"
                                (selectionChange)="costTypeChange($event)"
                            >
                                <mat-option
                                    *ngFor="let type of timeAndMaterialType"
                                    [value]="type"
                                >
                                    {{ type?.label }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>

                    <div
                        class="w-[200px]"
                        *ngIf="
                            timeAndMaterialForm?.get('type')?.value?.value ===
                                'FLAT_RATE' &&
                            fixedCostForm?.get('costType')?.value?.value ===
                                'TANDM'
                        "
                    >
                        <mat-form-field class="w-full">
                            <mat-label>Enter cost</mat-label>
                            <input
                                type="number"
                                matInput
                                formControlName="costInput"
                                placeholder="Enter cost"
                                min="0"
                            />
                            <mat-error
                                *ngIf="
                                    timeAndMaterialForm
                                        ?.get('costInput')
                                        .hasError('required')
                                "
                            >
                                Cost is <strong>required</strong>
                            </mat-error>
                            <mat-error
                                *ngIf="
                                    timeAndMaterialForm
                                        ?.get('costInput')
                                        ?.hasError('pattern')
                                "
                            >
                                <div>
                                    Please enter valid <strong>cost</strong>
                                </div>
                            </mat-error>
                        </mat-form-field>
                    </div>

                    <div
                        formArrayName="resources"
                        class="w-full"
                        *ngIf="
                            timeAndMaterialForm?.get('type')?.value?.value ===
                                'RESOURCE_SPECIFIC' &&
                            fixedCostForm?.get('costType')?.value?.value ===
                                'TANDM'
                        "
                    >
                        <ng-container
                            *ngFor="
                                let resource of resources?.controls;
                                let i = index;
                                let last = last
                            "
                        >
                            <form [formGroupName]="i">
                                <div class="flex gap-4 w-full">
                                    <div class="flex-1">
                                        <mat-form-field
                                            class="w-full"
                                            id="userlist"
                                            [floatLabel]="'always'"
                                        >
                                            <mat-label>Name</mat-label>
                                            <input
                                                matInput
                                                placeholder="Certificate Name"
                                                formControlName="name"
                                                class="inputlist"
                                            />
                                        </mat-form-field>
                                    </div>

                                    <div class="flex-1">
                                        <div class="w-full flex gap-2">
                                            <mat-form-field
                                                class="w-full max-w-[125px]"
                                            >
                                                <mat-label
                                                    >Hourly cost</mat-label
                                                >
                                                <input
                                                    type="number"
                                                    matInput
                                                    formControlName="cost"
                                                    placeholder="Enter cost"
                                                    min="0"
                                                />
                                                <mat-error
                                                    *ngIf="
                                                        resource
                                                            ?.get('cost')
                                                            .hasError(
                                                                'required'
                                                            )
                                                    "
                                                >
                                                    Cost is
                                                    <strong>required</strong>
                                                </mat-error>
                                                <mat-error
                                                    *ngIf="
                                                        !resource
                                                            ?.get('cost')
                                                            .hasError(
                                                                'required'
                                                            ) &&
                                                        resource
                                                            ?.get('cost')
                                                            ?.hasError(
                                                                'pattern'
                                                            )
                                                    "
                                                >
                                                    <div>
                                                        Please enter valid
                                                        <strong>cost</strong>
                                                    </div>
                                                </mat-error>
                                            </mat-form-field>

                                            <mat-form-field
                                                class="w-full"
                                                *ngIf="
                                                    resource?.get('vendor')
                                                        ?.value
                                                "
                                            >
                                                <mat-label
                                                    >Cost to company</mat-label
                                                >
                                                <input
                                                    type="number"
                                                    matInput
                                                    formControlName="costToCompany"
                                                    placeholder="Enter cost"
                                                    min="0"
                                                />
                                                <mat-error
                                                    *ngIf="
                                                        resource
                                                            ?.get(
                                                                'costToCompany'
                                                            )
                                                            .hasError(
                                                                'required'
                                                            )
                                                    "
                                                >
                                                    Cost is
                                                    <strong>required</strong>
                                                </mat-error>
                                                <mat-error
                                                    *ngIf="
                                                        !resource
                                                            ?.get(
                                                                'costToCompany'
                                                            )
                                                            .hasError(
                                                                'required'
                                                            ) &&
                                                        resource
                                                            ?.get(
                                                                'costToCompany'
                                                            )
                                                            ?.hasError(
                                                                'pattern'
                                                            )
                                                    "
                                                >
                                                    <div>
                                                        Please enter valid
                                                        <strong>cost</strong>
                                                    </div>
                                                </mat-error>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </ng-container>
                    </div>
                </form>
            </div>
        </div>
    </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
    <button
        mat-flat-button
        [color]="'primary'"
        [disabled]="isLoading"
        (click)="cancel()"
    >
        <mat-icon *ngIf="!isLoading" class="mr-2">close</mat-icon>
        Cancel
    </button>
    <button
        mat-flat-button
        [color]="'primary'"
        [disabled]="isLoading"
        (click)="submit()"
    >
        <mat-icon *ngIf="!isLoading" class="mr-2">add</mat-icon>
        <mat-progress-spinner
            *ngIf="isLoading"
            class="mr-2"
            mode="indeterminate"
            diameter="24"
        ></mat-progress-spinner>
        Save
    </button>
</mat-dialog-actions>
